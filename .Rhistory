db <- make_cellchatdb(node)
geneinfo <- unique(c(node$ligand,node&receptor))
get_nodes <- function(identifiers,species=9606,required_score=400,network_type="functional",add_nodes=100,show_query_node_labels=0,caller_identity="Anonymous"){
if(length(identifiers)>1){
gene_identity <- paste(identifiers,sep="",collapse = "%0d")
}
else{
gene_identity=identifiers
}
node_url <- c("https://string-db.org/api/tsv/network?identifiers=",gene_identity,"&","species=",species,"&",
"required_score=",required_score,"&","network_type=",network_type,"&","add_nodes=",add_nodes,"&",
"show_query_node_labels=",show_query_node_labels,"&","caller_identity=",caller_identity)
node_url <- paste(node_url,sep = "",collapse = "")
download.file(node_url,destfile = "nodes.tsv")
node_file <- read.csv("nodes.tsv",sep = "\t")[,c(3,4)]
node_file <- node_file[duplicated(node_file),]
colnames(node_file) <- c("ligand","receptor")
node_file$interaction_name <- paste0(node_file$ligand,"-",node_file$receptor)
return(node_file)
}
node <- get_nodes(c("TP53","EGFR","CDK2"))
node$receptor
c(node$ligand,node$receptor)
unique(c(node$ligand,node$receptor))
get_nodes <- function(identifiers,species=9606,required_score=400,network_type="functional",add_nodes=100,show_query_node_labels=0,caller_identity="Anonymous"){
if(length(identifiers)>1){
gene_identity <- paste(identifiers,sep="",collapse = "%0d")
}
else{
gene_identity=identifiers
}
node_url <- c("https://string-db.org/api/tsv/network?identifiers=",gene_identity,"&","species=",species,"&",
"required_score=",required_score,"&","network_type=",network_type,"&","add_nodes=",add_nodes,"&",
"show_query_node_labels=",show_query_node_labels,"&","caller_identity=",caller_identity)
node_url <- paste(node_url,sep = "",collapse = "")
download.file(node_url,destfile = "nodes.tsv")
node_file <- read.csv("nodes.tsv",sep = "\t")[,c(3,4)]
node_file <- node_file[duplicated(node_file),]
colnames(node_file) <- c("ligand","receptor")
node_file$interaction_name <- paste0(node_file$ligand,"-",node_file$receptor)
return(node_file)
}
node <- get_nodes(c("TP53","EGFR","CDK2"))
make_cellchatdb <- function(interaction_nodes){
geneinfo <- unique(c(interaction_nodes$ligand,interaction_nodes$receptor))
return(updateCellChatDB(interaction_nodes,
gene_info = geneinfo,
other_info = NULL,
merged = FALSE,
species_target = NULL
))
}
db <- make_cellchatdb(node)
library(CellChat)
db <- make_cellchatdb(node)
geneinfo <- unique(c(node$ligand,node$receptor))
colnames(geneinfo)
rownames(geneinfo)
make_cellchatdb <- function(interaction_nodes){
geneinfo$Symbol <- unique(c(interaction_nodes$ligand,interaction_nodes$receptor))
return(updateCellChatDB(interaction_nodes,
gene_info = geneinfo,
other_info = NULL,
merged = FALSE,
species_target = NULL
))
}
db <- make_cellchatdb(node)
make_cellchatdb <- function(interaction_nodes){
geneinfo <- as.data.frame(unique(c(interaction_nodes$ligand,interaction_nodes$receptor)))
colnames(geneinfo) <- "Symbol"
return(updateCellChatDB(interaction_nodes,
gene_info = geneinfo,
other_info = NULL,
merged = FALSE,
species_target = NULL
))
}
db <- make_cellchatdb(node)
get_nodes <- function(identifiers,species=9606,required_score=400,network_type="functional",add_nodes=100,show_query_node_labels=0,caller_identity="Anonymous"){
if(length(identifiers)>1){
gene_identity <- paste(identifiers,sep="",collapse = "%0d")
}
else{
gene_identity=identifiers
}
node_url <- c("https://string-db.org/api/tsv/network?identifiers=",gene_identity,"&","species=",species,"&",
"required_score=",required_score,"&","network_type=",network_type,"&","add_nodes=",add_nodes,"&",
"show_query_node_labels=",show_query_node_labels,"&","caller_identity=",caller_identity)
node_url <- paste(node_url,sep = "",collapse = "")
download.file(node_url,destfile = "nodes.tsv")
node_file <- read.csv("nodes.tsv",sep = "\t")[,c(3,4)]
node_file <- node_file[duplicated(node_file),]
colnames(node_file) <- c("ligand","receptor")
node_file$interaction_name <- paste0(node_file$ligand,"-",node_file$receptor)
node_file$pathway_name <- node_file$ligand
return(node_file)
}
node <- get_nodes(c("TP53","EGFR","CDK2"))
make_cellchatdb <- function(interaction_nodes){
geneinfo <- as.data.frame(unique(c(interaction_nodes$ligand,interaction_nodes$receptor)))
colnames(geneinfo) <- "Symbol"
return(updateCellChatDB(interaction_nodes,
gene_info = geneinfo,
other_info = NULL,
merged = FALSE,
species_target = NULL
))
}
db <- make_cellchatdb(node)
load_all()
get_nodes("gabrd",species=310571)
load_all()
load_all()
get_nodes("gabrd",species=310571)
get_nodes <- function(identifiers,species=9606,required_score=400,network_type="functional",add_nodes=100,show_query_node_labels=0,caller_identity="Anonymous"){
if(length(identifiers)>1){
gene_identity <- paste(identifiers,sep="",collapse = "%0d")
}
else{
gene_identity=identifiers
}
node_url <- c("https://string-db.org/api/tsv/network?identifiers=",gene_identity,"&","species=",species,"&",
"required_score=",required_score,"&","network_type=",network_type,"&","add_nodes=",add_nodes,"&",
"show_query_node_labels=",show_query_node_labels,"&","caller_identity=",caller_identity)
node_url <- paste(node_url,sep = "",collapse = "")
download.file(node_url,destfile = "nodes.tsv")
node_file <- read.csv("nodes.tsv",sep = "\t")[,c(3,4)]
node_file <- node_file[duplicated(node_file),]
colnames(node_file) <- c("ligand","receptor")
node_file$interaction_name <- paste0(node_file$ligand,"-",node_file$receptor)
node_file$pathway_name <- node_file$ligand
return(node_file)
}
get_nodes("gabrd",species=310571)
library(STRINGdb)
get_nodes <- function(identifiers,species=9606,required_score=400,network_type="functional",add_nodes=100,show_query_node_labels=0,caller_identity="Anonymous"){
if(length(identifiers)>1){
gene_identity <- paste(identifiers,sep="",collapse = "%0d")
}
else{
gene_identity=identifiers
}
node_url <- c("https://string-db.org/api/tsv/network?identifiers=",gene_identity,"&","species=",species,"&",
"required_score=",required_score,"&","network_type=",network_type,"&","add_nodes=",add_nodes,"&",
"show_query_node_labels=",show_query_node_labels,"&","caller_identity=",caller_identity)
node_url <- paste(node_url,sep = "",collapse = "")
download.file(node_url,destfile = "nodes.tsv")
node_file <- read.csv("nodes.tsv",sep = "\t")[,c(3,4)]
node_file <- node_file[duplicated(node_file),]
colnames(node_file) <- c("ligand","receptor")
node_file$interaction_name <- paste0(node_file$ligand,"-",node_file$receptor)
node_file$pathway_name <- node_file$ligand
return(node_file)
}
library(devtools)
make_cellchatdb <- function(interaction_nodes,enrich=NULL){
if (is.null(enrich)){}
else {interaction_nodes$evidence=enrich}
geneinfo <- as.data.frame(unique(c(interaction_nodes$ligand,interaction_nodes$receptor)))
colnames(geneinfo) <- "Symbol"
return(updateCellChatDB(interaction_nodes,
gene_info = geneinfo,
other_info = NULL,
merged = FALSE,
species_target = NULL))
}
get_nodes(c("CDK2","TP53","CD43"))
node <- get_nodes(c("CDK2","TP53","CD43"))
make_cellchatdb(node)
db <- make_cellchatdb(node)
use-git()
library(devtools)
use_git()
use_git()
use_git()
use_r("down_gtf.R")
use_r("get_nodes.R")
use_r("make_cellchatdb.R")
use_r("make_customdb.R")
use_package("rtracklayer")
use_package("rtracklayer")
use_package("CellChat")
use_package("STRINGdb")
document()
load_all()
check()
library(devtools)
load_all()
check()
down_gtf()
check()
?download.file
?unzip
?read.csv
use_package("utils")
check()
?use_package
?usethis
??usethis
use_package("STRINGdb",type ="LinkingTo")
check()
document()
DESCRIPTION
DESCRIPTION()
use_mit_license()
document()
?down_gtf
document()
?down_gtf
down_gtf(GCF_000001405.40)
?down_gtf
document()
document()
?make_cellchatdb
document()
?make_cellchatdb
document()
document()
document()
?get_nodes()
check()
check()
check()
install()
install()
??tocelldb
?tocelldb
check()
check()
library(devtools)
check()
check()
document()
getwd()
library(devtools)
document()
check()
check()
document()
load_all()
install()
check()
library(devtools)
check()
document()
install_github("r-lib/roxygen2")
check()
check()
use_git()
devtools::load_all(".")
library(tocelldb)
use_r("down_protein.R")
document()
check
check()
document()
check()
check()
use_package("rtracklayer")
check()
#' Download a gtf file from ncbi.
#'@description
#' Download a gtf file from ncbi and get gene & protein infomations.
#'
#' @param No.assembly NCBI assembly number, such as "GCF_000001405.40".
#'
#' @return gene & protein informations.
#' @export
#'
#' @examples NA
down_gtf <- function(No.assembly){
node_url <- c("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/",No.assembly,"/download?include_annotation_type=GENOME_GTF")
node_url <- paste(node_url,sep = "",collapse = "")
filename <- paste(No.assembly,".zip",sep = "",collapse = "")
utils::download.file(node_url,destfile = filename)
gtf <- paste("ncbi_dataset/data/",No.assembly,"/genomic.gtf",sep = "",collapse = "")
utils::unzip(filename,gtf)
gtf <- rtracklayer::import('genomic.gtf')
gtf <- as.data.frame(gtf)
Protein <- gtf[,c("protein_id","gene")]
Protein <- Protein[is.na(Protein$protein_id)==F,]
return(Protein)
}
load_all()
check()
document()
document()
check()
install()
use_r("down_protein.R")
document()
document()
use_r("down_protein.R")
document()
library(devtools)
library(devtools)
document()
document()
document()
document()
check()
load_all()
install()
down_protein("GCF_000001405.40")
?download.file
check()
load_all()
install()
load_all()
install()
down_protein("GCF_000001405.40")
load_all()
install()
down_protein("GCF_000001405.40")
load_all()
check()
install()
down_protein("GCF_000001405.40")
??curl
curl("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA")
curl::curl("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA")
curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA", ncbidata.zip)
curl::curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA", ncbidata.zip)
curl::curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA", tmp)
curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA", "ncbidata.zip")
curl::curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA", "ncbidata.zip")
?download.file
download.file("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40/download?include_annotation_type=PROT_FASTA",destfile = "ncbi.zip",method="wget")
check()
install()
curl::curl_download("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/GCF_000001405.40%2CGCF_000001635.27/download?chromosomes=1&chromosomes=2&chromosomes=3&chromosomes=X&chromosomes=Y&chromosomes=MT&include_annotation_type=PROT_FASTA", "ncbidata.zip")
？download.file
?download.file
#' Download a protein.fasta file from ncbi.
#'@description
#'Download a protein.fasta file from ncbi and uploaded to STRINGdb.
#'
#' @param No.assembly NCBI assembly number, such as "GCF_000001405.40".
#'
#' @return NA
#' @export
#'
#' @examples NA
down_protein <- function(No.assembly){
node_url <- c("https://api.ncbi.nlm.nih.gov/datasets/v2alpha/genome/accession/",No.assembly,"/download?include_annotation_type=PROT_FASTA")
node_url <- paste(node_url,sep = "",collapse = "")
filename <- paste(No.assembly,".zip",sep = "",collapse = "")
utils::download.file(node_url,destfile = filename,method="libcurl",extra = "api-key: halldave")
pro <- paste("ncbi_dataset/data/",No.assembly,"/protein.faa",sep = "",collapse = "")
utils::unzip(filename,pro)
}
down_protein("GCF_000001405.40")
BiocManager::install("ncbi")
BiocManager::install("ncbi")
use_r("deal_gtf.R")
document()
check
check()
library(devtools)
check()
document()
check()
load_all()
install()
check()
check()
document()
install()
library(devtools)
load_all()
protein <- deal_gtf("fish.gtf")
make_customdb("glutamate.tsv",protein)
interaction_nodes <- "glutamate.tsv"
Protein2Gene <- utils::read.csv(interaction_nodes,sep="\t")[,c(1,2)]
tmp1 <- Protein2Gene[,1]
tmp2 <- Protein2Gene[,2]
if (is.null(enrich)){}
for (i in 1:length(Protein2Gene$V2)) {
gene1 <- gene_info$gene[match(tmp1[i],gene_info$protein_id)]
gene2 <- gene_info$gene[match(tmp2[i],gene_info$protein_id)]
tmp1[i] <- gene1
tmp2[i] <- gene2
print(i)
}
gene_info <- protein
for (i in 1:length(Protein2Gene$V2)) {
gene1 <- gene_info$gene[match(tmp1[i],gene_info$protein_id)]
gene2 <- gene_info$gene[match(tmp2[i],gene_info$protein_id)]
tmp1[i] <- gene1
tmp2[i] <- gene2
print(i)
}
Protein2Gene[,1] <- tmp1
Protein2Gene[,2] <- tmp2
colnames(Protein2Gene[,c(1,2)]) <- c("ligand","receptor")
Protein2Gene$interaction_name <- paste0(Protein2Gene$ligand,"-",Protein2Gene$receptor)
Protein2Gene$pathway_name <- Protein2Gene$ligand
geneinfo <- as.data.frame(unique(c(Protein2Gene$ligand,Protein2Gene$receptor)))
colnames(geneinfo) <- "Symbol"
check()
check()
load_all()
install()
protein <- deal_gtf("fish.gtf")
protein <- deal_gtf("fish.gtf")
make_customdb("glutamate.tsv",protein,enrich = "KEGG : ely00250")
make_customdb("glutamate.tsv",protein)
Protein2Gene <- utils::read.csv(interaction_nodes,sep="\t")[,c(1,2)]
tmp1 <- Protein2Gene[,1]
tmp2 <- Protein2Gene[,2]
if (is.null(enrich)){}
else
{
Protein2Gene[,3] <- enrich
colnames(Protein2Gene[,3]) <- "evidence"
}
for (i in 1:length(Protein2Gene$V2)) {
gene1 <- gene_info$gene[match(tmp1[i],gene_info$protein_id)]
gene2 <- gene_info$gene[match(tmp2[i],gene_info$protein_id)]
tmp1[i] <- gene1
tmp2[i] <- gene2
print(i)
}
Protein2Gene[,1] <- tmp1
Protein2Gene[,2] <- tmp2
colnames(Protein2Gene[,c(1,2)]) <- c("ligand","receptor")
View(Protein2Gene)
colnames(Protein2Gene) <- c("ligand","receptor")
check()
protein <- deal_gtf("fish.gtf")
make_customdb("glutamate.tsv",protein,enrich = "KEGG : ely00250")
make_customdb("glutamate.tsv",protein)
check()
load_all()
install()
protein <- deal_gtf("fish.gtf")
make_customdb("glutamate.tsv",protein)
chatdb <- make_customdb("glutamate.tsv",protein)
col(protein)
check()
load_all()
install()
chatdb <- make_customdb("glutamate.tsv",protein)
get_nodes(c("TP53","CDK2,"CD34))
nodes <- get_nodes(c("TP53","CDK2,"CD34""))
nodes <- get_nodes(c("TP53","CDK2,"CD34"))
nodes <- get_nodes(c("TP53","CDK2"),species=9606)
nodes <- get_nodes(c("TP53","CDK2","CD34"),species=9606)
make_cellchatdb(nodes)
chatdb <- make_cellchatdb(nodes)
chatdb <- make_cellchatdb(nodes,enrich = "KEGG : 02020")
make_customdb("glutamate.tsv",protein,enrich = "KEGG:02020")
check()
load_all()
install()
make_customdb("glutamate.tsv",protein,enrich = "KEGG:02020")
make_customdb("glutamate.tsv",protein,enrich = "KEGG:02020")
check_all()
check()
load_all()
install()
make_customdb("glutamate.tsv",protein,enrich = "KEGG:02020")
check()
load_all()
install()
library(devtools)
load_all()
check()
load_all()
install()
?make_cellchatdb
check()
?make_cellchatdb
check()
document（
document()
check()
library(devtools)
check()
load_all()
install()
make_cellchatdb
library(devtools)
check()
load_all()
install()
library(tocelldb)
rfq_nodes <- get_nodes(c("PPAT","GPR143","GAD1","ALDH5A1","GOT2","NAT8L","ASPA","FOLH1"),
species = 59479,
required_score = 400,
network_type = "functional",
show_query_node_labels = 0,
add_nodes = 10,
caller_identity = "Dave")
rfq_cellchatdb <- make_customdb(rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
rfq_cellchatdb <- make_customdb(rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
check()
load_all()
install()
rfq_cellchatdb <- make_customdb(rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
rfq_cellchatdb <- make_customdb(interaction_nodes=rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
check()
load_all()
install()
rfq_cellchatdb <- make_customdb(interaction_nodes=rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
rfq_cellchatdb <- make_customdb(rfq_nodes, enrich = "KEGG：rfq00250", annotation = "Secreted Signaling")
check()
document
document()
load_all()
install()
